/*
 * generated by Xtext 2.14.0
 */
package org.xtext.example.mydsl.generator

import org.eclipse.emf.ecore.resource.Resource
import org.eclipse.xtext.generator.AbstractGenerator
import org.eclipse.xtext.generator.IFileSystemAccess2
import org.eclipse.xtext.generator.IGeneratorContext
import nicoLang.FSM
import java.util.HashMap

/**
 * Generates code from your model files on save.
 * 
 * See https://www.eclipse.org/Xtext/documentation/303_runtime_concepts.html#code-generation
 */
class MyDslGenerator extends AbstractGenerator {

	override void doGenerate(Resource resource, IFileSystemAccess2 fsa, IGeneratorContext context) {
		var myFsm = resource.contents.get(0) as FSM
		myFsm.state.forEach[s | fsa.generateFile(s.name + '.java', genrateStateClass(s))]
		var sourceToTarget = getSrcToTarget(myFsm);
		
//		fsa.generateFile("Main.java", genrateMainClass(myFsm));
//		myFsm.transition.forEach[ t | ]
	}
	
	def private String genrateStateClass (nicoLang.State s){
		'''
		public class « s.name» {
			String name = « s.name» ;
		}
		'''
	}
	
	def private HashMap<String,String> getSrcToTarget(FSM fsm){
		var result = new HashMap<String, String >()
		fsm.transition.forEach[t | result.add(t.source.name , t.target.name)]
		return result
	}
	
	def private String genrateMainClass (FSM fsm){
		'''
		public class « fsm.name» {
			String name = « fsm.name» ;
			String initState = « fsm.state.get(0).name»
			//State current = initialState ;
			public static void main(String [] args){
				
			}
		}
		'''
	}
}
